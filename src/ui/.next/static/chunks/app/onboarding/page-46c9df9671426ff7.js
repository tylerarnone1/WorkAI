(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[566],{63:(e,a,t)=>{"use strict";var r=t(7260);t.o(r,"useParams")&&t.d(a,{useParams:function(){return r.useParams}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}})},3870:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>g});var r=t(5155),s=t(4486),o=t(6489),n=t(63),i=t(2115);let l="ai_employee_pending_hire",d="ai_employee_onboarding_state";function c(){return"".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}function u(e){return e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function m(e){return new Promise(a=>setTimeout(a,e))}function p(e){let{text:a,speedMs:t=16}=e,[s,o]=(0,i.useState)(""),[n,l]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{let e=0;o(""),l(!1);let r=window.setInterval(()=>{e+=1,o(a.slice(0,e)),e>=a.length&&(l(!0),window.clearInterval(r))},t);return()=>window.clearInterval(r)},[t,a]),(0,r.jsxs)("span",{children:[s,(0,r.jsx)("span",{className:"ml-0.5 inline-block w-[7px] align-middle ".concat(n?"opacity-0":"animate-pulse opacity-100"),children:"|"})]})}function g(){var e;let a=(0,n.useRouter)(),{status:t}=(0,o.useSession)(),g=(0,i.useRef)(!1),h=(0,i.useRef)(null),x=(0,i.useRef)(Promise.resolve()),b=(0,i.useRef)(!1),[y,f]=(0,i.useState)(null),[w,N]=(0,i.useState)([]),[v,j]=(0,i.useState)("name"),[S,k]=(0,i.useState)(""),[I,C]=(0,i.useState)(null),[P,_]=(0,i.useState)(!1),[M,O]=(0,i.useState)(!1),[E,G]=(0,i.useState)(""),[W,R]=(0,i.useState)(""),[L,J]=(0,i.useState)(""),[A,F]=(0,i.useState)(null),[U,T]=(0,i.useState)(null),[Y,D]=(0,i.useState)(null),z=(0,i.useMemo)(()=>y?u(y.roleSlug):"AI teammate",[y]),H=e=>{N(a=>[...a,e])},V=e=>{H({id:c(),role:"user",text:e})},q=(e,a)=>{var t,r;let s=null!=(t=null==a?void 0:a.delayMs)?t:280,o=null!=(r=null==a?void 0:a.typingSpeedMs)?r:16;return x.current=x.current.then(async()=>{O(!0),await m(s),H({id:c(),role:"assistant",text:e,typingSpeedMs:o});let a=Math.min(3200,Math.max(700,e.length*o+300));await m(a),O(!1)}),x.current};(0,i.useEffect)(()=>{if(!y)return;let e={roleSlug:y.roleSlug,resumeId:y.resume.id,messages:w,step:v,name:E,email:W,workspaceName:L,googleAuthChoice:A};sessionStorage.setItem(d,JSON.stringify(e))},[y,w,v,E,W,L,A]),(0,i.useEffect)(()=>{if(g.current)return;g.current=!0,T(new URLSearchParams(window.location.search).get("oauth"));let e=sessionStorage.getItem(l);if(!e)return void D("No pending hire found. Choose a candidate first.");try{var a,t,r,s,o,n,i;let l=JSON.parse(e);if(!l.roleSlug||!(null==(a=l.resume)?void 0:a.id))throw Error("Pending hire data is incomplete.");f(l);let c=sessionStorage.getItem(d);if(c){let e=JSON.parse(c);if(e.roleSlug===l.roleSlug&&e.resumeId===l.resume.id){N(null!=(t=e.messages)?t:[]),j(null!=(r=e.step)?r:"name"),G(null!=(s=e.name)?s:""),R(null!=(o=e.email)?o:""),J(null!=(n=e.workspaceName)?n:""),F(null!=(i=e.googleAuthChoice)?i:null);return}}q("Hi, I am ".concat(l.resume.name,", your new ").concat(u(l.roleSlug),". What should I call you?"),{delayMs:450,typingSpeedMs:14})}catch(e){console.error("Failed to parse onboarding state:",e),D("We could not restore your hire session. Please start again.")}},[]),(0,i.useEffect)(()=>{var e;null==(e=h.current)||e.scrollIntoView({behavior:"smooth"})},[w,M]),(0,i.useEffect)(()=>{if("google-wait"!==v){b.current=!1;return}"authenticated"!==t||b.current||(b.current=!0,(async()=>{await q("Google account connected. Nice and clean.",{typingSpeedMs:14}),await q("Last step: what should we call your workspace?",{typingSpeedMs:14}),j("workspace")})())},[t,v]);let B=async e=>{e.preventDefault(),C(null);let a=S.trim();if(!a)return void C("Please enter a response.");if("name"===v){G(a),V(a),k(""),await q("Great to meet you, ".concat(a,". Excited to get to work. First, let's set up your account. What is your email?"),{typingSpeedMs:14}),j("email");return}if("email"===v)return a.includes("@")&&a.includes(".")?(R(a),V(a),k(""),void(a.toLowerCase().endsWith("@gmail.com")?(await q("Looks like a Gmail address. Would you like to sign in with your Google account?",{typingSpeedMs:14}),j("google-choice")):(await q("Perfect. One more thing: what should we call your workspace?",{typingSpeedMs:14}),j("workspace")))):void C("Enter a valid email address.");if("workspace"===v){if(a.length<2)return void C("Workspace name should be at least 2 characters.");J(a),V(a),k(""),await q("Amazing. Setup is complete. When you are ready, I will join ".concat(a," and start delivering immediately."),{typingSpeedMs:14}),j("launch-ready")}},K=async e=>{if(C(null),F(e),V(e?"Yes, sign in with Google":"No, continue manually"),!e){await q("No problem. We will keep your account on email and password."),await q("Last step: what should we call your workspace?"),j("workspace");return}if("authenticated"===t){await q("Google account already connected."),await q("Last step: what should we call your workspace?"),j("workspace");return}if(await q("Great choice. Opening Google sign-in now."),j("google-wait"),y){let e={roleSlug:y.roleSlug,resumeId:y.resume.id,messages:w,step:"google-wait",name:E,email:W,workspaceName:L,googleAuthChoice:!0};sessionStorage.setItem(d,JSON.stringify(e))}await (0,o.signIn)("google",{callbackUrl:"/onboarding?oauth=google"})},Q=async()=>{F(!1),await q("No problem. We will continue with email and password."),await q("Last step: what should we call your workspace?"),j("workspace")},X=async()=>{C(null),await (0,o.signIn)("google",{callbackUrl:"/onboarding?oauth=google"})},Z=async()=>{if(!y)return void C("Missing hire information. Please choose a candidate again.");C(null),_(!0);try{let t=await fetch("/api/agents/hire",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateId:y.roleSlug,backgroundId:y.resume.id,generatedName:y.resume.name,generatedResume:y.resume})});if(!t.ok){var e;let a=await t.json().catch(()=>({}));throw Error(null!=(e=null==a?void 0:a.details)?e:"Failed to complete hiring.")}localStorage.setItem("ai_employee_profile",JSON.stringify({name:E,email:W,workspaceName:L,googleAuthChoice:A}));let r={ownerName:E||"there",workspaceName:L||"your workspace",hireName:y.resume.name,roleName:u(y.roleSlug),usedGoogle:!0===A,fromOAuthCallback:"google"===U};sessionStorage.setItem("ai_employee_onboarding_complete",JSON.stringify(r)),sessionStorage.removeItem(l),sessionStorage.removeItem(d),a.push("/welcome")}catch(e){console.error("Failed to complete onboarding:",e),C(e instanceof Error?e.message:"Could not complete onboarding."),_(!1)}};return Y?(0,r.jsx)("main",{className:"min-h-screen flex items-center justify-center p-8",children:(0,r.jsxs)("div",{className:"max-w-md w-full rounded-2xl border border-border bg-card p-8 text-center space-y-4",children:[(0,r.jsx)("p",{className:"text-lg font-semibold",children:Y}),(0,r.jsx)("button",{onClick:()=>a.push("/hire"),className:"w-full rounded-xl bg-gradient-to-r from-primary to-secondary px-4 py-3 font-semibold",children:"Pick a candidate"})]})}):(0,r.jsxs)("main",{className:"relative min-h-screen overflow-hidden bg-background px-4 py-8 sm:px-6",children:[(0,r.jsxs)(s.P.div,{"aria-hidden":"true",className:"pointer-events-none absolute inset-0",initial:{opacity:0},animate:{opacity:1},children:[(0,r.jsx)(s.P.div,{className:"absolute -left-20 top-10 h-80 w-80 rounded-full bg-primary/20 blur-3xl",animate:{x:[0,30,-10,0],y:[0,25,-15,0]},transition:{duration:14,repeat:1/0,ease:"easeInOut"}}),(0,r.jsx)(s.P.div,{className:"absolute -right-24 bottom-0 h-96 w-96 rounded-full bg-accent/20 blur-3xl",animate:{x:[0,-20,15,0],y:[0,-25,20,0]},transition:{duration:16,repeat:1/0,ease:"easeInOut"}})]}),(0,r.jsxs)("div",{className:"relative mx-auto grid min-h-[92vh] max-w-6xl gap-6 lg:grid-cols-[1.1fr_1fr]",children:[(0,r.jsxs)(s.P.section,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.5},className:"rounded-3xl border border-border bg-card/70 p-6 backdrop-blur sm:p-8",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-[0.25em] text-primary",children:"Onboarding session"}),(0,r.jsxs)("h1",{className:"mt-3 text-3xl font-bold leading-tight sm:text-4xl",children:[null!=(e=null==y?void 0:y.resume.name)?e:"Your new hire"," is ready to join."]}),(0,r.jsxs)("p",{className:"mt-3 text-sm text-muted",children:["We are setting up your account and workspace for your first"," ",z,"."]}),(0,r.jsxs)("div",{className:"mt-8 space-y-3 text-sm",children:[(0,r.jsxs)("div",{className:"rounded-xl border border-border bg-background/50 p-4",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-wider text-muted",children:"Candidate"}),(0,r.jsx)("p",{className:"mt-1 font-semibold",children:null==y?void 0:y.resume.name}),(0,r.jsx)("p",{className:"text-muted",children:null==y?void 0:y.resume.backgroundName})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-border bg-background/50 p-4",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-wider text-muted",children:"Role"}),(0,r.jsx)("p",{className:"mt-1 font-semibold",children:z})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-border bg-background/50 p-4",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-wider text-muted",children:"Status"}),(0,r.jsx)("p",{className:"mt-1 font-semibold text-primary",children:P?"Launching your teammate...":"google-wait"===v?"Waiting for Google sign-in callback":"Collecting account setup details"})]})]})]}),(0,r.jsxs)(s.P.section,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.55},className:"flex min-h-[540px] flex-col rounded-3xl border border-border bg-card p-4 sm:p-6",children:[(0,r.jsx)("div",{className:"mb-4 border-b border-border pb-4",children:(0,r.jsx)("p",{className:"text-sm text-muted",children:"Live setup chat"})}),(0,r.jsxs)("div",{className:"flex-1 space-y-3 overflow-y-auto pr-1",children:[w.map(e=>{var a;return(0,r.jsx)(s.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex ".concat("assistant"===e.role?"justify-start":"justify-end"),children:(0,r.jsx)("div",{className:"max-w-[88%] rounded-2xl px-4 py-3 text-sm leading-relaxed ".concat("assistant"===e.role?"border border-border bg-background text-foreground":"bg-gradient-to-r from-primary to-secondary text-white"),children:"assistant"===e.role?(0,r.jsx)(p,{text:e.text,speedMs:null!=(a=e.typingSpeedMs)?a:16}):e.text})},e.id)}),M?(0,r.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-start",children:(0,r.jsx)("div",{className:"max-w-[88%] rounded-2xl border border-border bg-background px-4 py-3 text-sm text-muted",children:(0,r.jsxs)("span",{className:"inline-flex gap-1",children:[(0,r.jsx)("span",{className:"h-2 w-2 animate-bounce rounded-full bg-primary/70 [animation-delay:-0.2s]"}),(0,r.jsx)("span",{className:"h-2 w-2 animate-bounce rounded-full bg-primary/70 [animation-delay:-0.1s]"}),(0,r.jsx)("span",{className:"h-2 w-2 animate-bounce rounded-full bg-primary/70"})]})})}):null,(0,r.jsx)("div",{ref:h})]}),(0,r.jsxs)("div",{className:"mt-4 border-t border-border pt-4",children:["google-choice"===v?(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2",children:[(0,r.jsx)("button",{onClick:()=>void K(!0),className:"rounded-xl border border-primary/50 bg-primary/10 px-4 py-3 text-sm font-semibold text-primary transition hover:bg-primary/20",children:"Yes, use Google"}),(0,r.jsx)("button",{onClick:()=>void K(!1),className:"rounded-xl border border-border bg-background px-4 py-3 text-sm font-semibold transition hover:border-primary/40",children:"No, continue manually"})]}):"google-wait"===v?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("button",{onClick:()=>void X(),className:"w-full rounded-xl border border-primary/50 bg-primary/10 px-4 py-3 text-sm font-semibold text-primary transition hover:bg-primary/20",children:"Open Google sign-in again"}),(0,r.jsx)("button",{onClick:()=>void Q(),className:"w-full rounded-xl border border-border bg-background px-4 py-3 text-sm font-semibold transition hover:border-primary/40",children:"Continue without Google"})]}):"launch-ready"===v?(0,r.jsx)("button",{onClick:Z,disabled:P,className:"w-full rounded-xl bg-gradient-to-r from-primary to-secondary px-5 py-3 text-sm font-semibold text-white transition-transform hover:scale-[1.01] disabled:cursor-not-allowed disabled:opacity-70",children:P?"Launching teammate...":"Finish setup and launch teammate"}):(0,r.jsxs)("form",{onSubmit:e=>void B(e),className:"space-y-3",children:[(0,r.jsx)("input",{value:S,onChange:e=>k(e.target.value),className:"w-full rounded-xl border border-border bg-background px-4 py-3 text-sm outline-none transition focus:border-primary",placeholder:"name"===v?"Enter your name":"email"===v?"Enter your email":"Workspace name",type:"email"===v?"email":"text"}),(0,r.jsx)("button",{type:"submit",className:"w-full rounded-xl bg-gradient-to-r from-primary to-secondary px-5 py-3 text-sm font-semibold text-white transition-transform hover:scale-[1.01]",children:"Continue"})]}),I?(0,r.jsx)("p",{className:"mt-3 text-xs text-red-300",children:I}):null]})]})]})]})}},4153:(e,a,t)=>{Promise.resolve().then(t.bind(t,3870))}},e=>{e.O(0,[486,489,441,255,358],()=>e(e.s=4153)),_N_E=e.O()}]);